<think>我需要编写一份详细的需求文档，基于中华万年历的原型，进一步完善以支持小程序开发。我应该涵盖每个页面的产品逻辑、交互流程、功能描述和技术要求等内容。已有的 prd.md 文件包含了基本的产品需求描述，我会在此基础上进行更详细的说明，特别针对小程序的开发需求。

需要包括的内容：
1. 项目概述 - 包括项目背景、目标、范围
2. 产品架构 - 技术栈、框架选择、整体架构
3. 小程序特有需求 - 权限要求、性能优化、生命周期管理
4. 页面详细需求 - 每个页面的功能、交互、逻辑和API接口规范
5. 数据模型设计 - 核心数据结构和存储需求
6. 非功能性需求 - 性能、可靠性、兼容性等
7. 开发与部署计划

我将按照这个结构，结合已有原型和产品需求文档，编写一份更加详细的小程序需求说明文档。</think># 中华万年历小程序 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 项目背景

中华万年历小程序旨在提供一个集传统中国历法与现代功能于一体的综合性日历应用，满足用户对传统文化了解和日常时间管理的需求。随着人们对传统文化的关注度提升和小程序应用场景的普及，开发一款融合传统文化与实用功能的日历小程序具有很好的市场前景和文化价值。

### 1.2 项目目标

开发一款功能完善、体验友好的万年历小程序，实现以下目标：
- 提供准确的公历、农历日期查询和转换功能
- 融合中国传统黄历信息，包括宜忌事项、吉神凶煞等
- 整合天气预报功能，方便用户日常生活安排
- 提供星座运势信息，满足用户对运势的关注需求
- 建立便捷的日程管理系统，提高用户的时间管理效率
- 打造符合现代审美的用户界面，提供流畅的小程序体验

### 1.3 目标用户

- **年龄范围**：18-60岁
- **主要用户群体**：
  - 对传统文化有兴趣的年轻人和中年人
  - 需要便捷时间管理工具的上班族
  - 关注天气变化的户外活动爱好者
  - 对个人运势感兴趣的用户
  - 重视传统节日和习俗的家庭用户

### 1.4 项目范围

- 微信小程序平台适配
- 主题色调：#e63946（暗红色）
- 包含10个主要功能页面
- 提供离线功能支持和在线数据同步
- 支持个性化设置和推送功能

## 2. 小程序架构与技术要求

### 2.1 技术架构

- **前端框架**：微信小程序原生框架
- **UI组件库**：自研组件库 + WeUI组件
- **状态管理**：小程序全局状态管理
- **数据存储**：微信云开发数据库 + 本地存储
- **API服务**：微信云函数 + 第三方API接口

### 2.2 微信小程序特有需求

- **授权要求**：
  - 位置信息授权（用于天气功能）
  - 用户基本信息授权（用于个性化推荐）
  - 推送消息授权（用于日程提醒）
  
- **小程序能力接入**：
  - 订阅消息能力（日程、节日提醒）
  - 微信支付能力（会员功能）
  - 分享到朋友圈能力
  - 小程序码推广能力

- **性能要求**：
  - 首屏加载时间 < 3秒
  - 页面切换响应时间 < 0.5秒
  - 冷启动时间 < 2秒
  - 包体积控制在 2MB 以内

### 2.3 数据模型设计

#### 2.3.1 核心数据模型

1. **用户信息**
   ```
   User {
     id: String,               // 用户唯一标识
     nickName: String,         // 昵称
     avatarUrl: String,        // 头像URL
     gender: Number,           // 性别
     region: String,           // 所在地区
     settings: Object,         // 用户设置
     memberLevel: Number,      // 会员等级
     createTime: Timestamp,    // 创建时间
     lastLoginTime: Timestamp  // 最后登录时间
   }
   ```

2. **日程事件**
   ```
   Event {
     id: String,               // 事件ID
     userId: String,           // 所属用户ID
     title: String,            // 标题
     description: String,      // 描述
     startTime: Timestamp,     // 开始时间
     endTime: Timestamp,       // 结束时间
     isAllDay: Boolean,        // 是否全天
     location: String,         // 地点
     color: String,            // 颜色标记
     repeat: Object,           // 重复规则
     reminder: Array,          // 提醒设置
     lunarDate: Object,        // 对应农历日期
     createTime: Timestamp,    // 创建时间
     updateTime: Timestamp     // 更新时间
   }
   ```

3. **城市与天气**
   ```
   City {
     id: String,               // 城市ID
     userId: String,           // 所属用户ID
     name: String,             // 城市名称
     code: String,             // 城市代码
     isDefault: Boolean,       // 是否默认城市
     isLocationBased: Boolean, // 是否基于定位
     lastVisit: Timestamp      // 最后访问时间
   }
   
   Weather {
     cityId: String,           // 城市ID
     current: Object,          // 当前天气
     hourly: Array,            // 小时预报
     daily: Array,             // 每日预报
     airQuality: Object,       // 空气质量
     alerts: Array,            // 预警信息
     updateTime: Timestamp     // 更新时间
   }
   ```

#### 2.3.2 缓存数据策略

- **持久化存储数据**：用户设置、日程信息、常用城市列表
- **临时缓存数据**：天气信息(更新周期: 1小时)、黄历信息(更新周期: 1天)
- **在线实时数据**：天气预警、实时温度、空气质量

## 3. 页面详细需求

### 3.1 主页 - 日历页面 (home)

#### 3.1.1 页面描述
日历主页是小程序的核心页面，展示月视图日历，包含公历、农历日期和各类节假日标记。

#### 3.1.2 功能需求

1. **日历展示功能**
   - 月视图日历，可左右滑动切换月份
   - 上方显示当前年月，点击可快速跳转至特定月份/年份
   - 日期格子显示公历日期、农历日期、节假日标记
   - 当天日期高亮显示，使用红色边框标记
   - 已添加日程的日期有醒目标记
   - 支持下拉刷新更新日历数据

2. **搜索功能**
   - 顶部搜索按钮，点击跳转到搜索页面
   - 支持按日期、节日名称、日程内容搜索

3. **添加日程功能**
   - 右上角提供添加日程按钮
   - 点击日期格子也可进入日期详情并添加日程

4. **今日详情展示**
   - 今日黄历信息概览（宜忌要点）
   - 今日天气概览（温度和天气状态）
   - 今日待办事项提醒

5. **功能卡片模块**
   - 可定制展示的功能卡片
   - 支持天气卡片、黄历卡片、待办卡片等
   - 卡片可左右滑动查看更多

#### 3.1.3 交互设计

1. **日期选择交互**
   - 点击日期格子：进入该日期的详情页面
   - 长按日期格子：快速添加日程弹窗
   - 左右滑动：切换上/下月
   - 上下滑动：展开/收起功能卡片区域

2. **卡片交互**
   - 功能卡片支持左右滑动查看
   - 点击卡片上的"更多"或"详情"：跳转至对应功能页面
   - 下拉刷新：更新所有卡片数据

3. **底部标签栏**
   - 固定底部导航，"日历"标签高亮
   - 四个主要导航项：日历、黄历、天气、我的

#### 3.1.4 API接口需求

1. **日历数据接口**
   ```
   GET /api/calendar/month
   请求参数：year, month
   响应：当月日历数据，包含公历、农历、节假日
   ```

2. **今日详情接口**
   ```
   GET /api/calendar/today
   请求参数：location_id
   响应：今日完整信息，包含天气、黄历、日程
   ```

3. **用户日程接口**
   ```
   GET /api/events
   请求参数：start_date, end_date
   响应：指定日期范围内的日程数据
   ```

#### 3.1.5 页面状态管理

- **加载状态**：首次进入显示骨架屏，数据加载完成后显示实际内容
- **空状态**：无日程时显示引导添加日程的提示
- **网络异常**：提供离线缓存数据显示，并有重试按钮
- **下拉刷新**：显示刷新动画，数据更新完成后自动收起

### 3.2 日期详情页 (day_detail)

#### 3.2.1 页面描述
展示选定日期的详细信息，包括完整的农历信息、干支纪年、黄历宜忌、吉神凶煞等传统内容，以及该日的日程安排。

#### 3.2.2 功能需求

1. **基础日期信息**
   - 完整展示公历日期和星期
   - 农历日期和年份信息
   - 干支纪年、生肖年份
   - 特殊标记（如节气、节日）显示

2. **黄历详细信息**
   - 宜忌事项详细列表，分类展示
   - 今日五行和值神信息
   - 冲煞和星宿信息
   - 吉神凶煞方位详解
   - 时辰吉凶表
   - 彭祖百忌信息

3. **日程管理功能**
   - 显示当日已安排的所有日程
   - 支持添加新日程
   - 支持编辑、删除已有日程

4. **实用工具功能**
   - 添加提醒按钮
   - 分享日期信息功能
   - 收藏特殊日期功能

#### 3.2.3 交互设计

1. **页面导航**
   - 顶部提供返回按钮，回到日历主页
   - 顶部标题显示"日期详情"
   - 底部固定导航栏与其他页面保持一致

2. **内容区交互**
   - 农历信息卡片置顶显示
   - 宜忌事项可展开/收起详细解释
   - 日程列表按时间顺序排列
   - 长按日程项可呼出快捷操作菜单（编辑/删除）

3. **功能按钮交互**
   - 底部固定"添加提醒"、"分享日期"、"收藏"三个按钮
   - 点击"添加提醒"跳转至添加日程页面，预填当前日期
   - 点击"分享日期"弹出微信分享菜单
   - 点击"收藏"切换收藏状态，并有成功反馈

#### 3.2.4 API接口需求

1. **日期详情接口**
   ```
   GET /api/calendar/date
   请求参数：date (YYYY-MM-DD格式)
   响应：指定日期的完整信息
   ```

2. **日程查询接口**
   ```
   GET /api/events/date
   请求参数：date (YYYY-MM-DD格式)
   响应：指定日期的所有日程
   ```

3. **收藏日期接口**
   ```
   POST /api/favorite/date
   请求参数：date, type, remark
   响应：收藏状态
   ```

#### 3.2.5 页面状态管理

- **日期切换**：支持左右滑动切换前后日期
- **内容加载**：分块加载各部分内容，优先加载基础信息
- **错误处理**：特定部分加载失败不影响整体显示
- **收藏状态**：实时同步本地和云端状态

### 3.3 添加日程页 (add_event)

#### 3.3.1 页面描述
允许用户创建和编辑日历事件，设置标题、日期、时间、重复规则、提醒等，并提供农历参考信息辅助用户选择吉日。

#### 3.3.2 功能需求

1. **基本信息编辑**
   - 日程标题输入（必填）
   - 备注内容输入（选填）
   - 地点信息输入（选填）
   - 颜色标记选择（默认红色）

2. **时间设置**
   - 日期选择器，默认为当前选中日期
   - 全天事件开关，开启后隐藏时间选择
   - 开始时间和结束时间选择（非全天事件）
   - 重复规则设置（不重复、每天、每周、每月、每年、自定义）

3. **提醒设置**
   - 提醒时间选项（无提醒、事件开始时、5分钟前、15分钟前、1小时前、1天前等）
   - 支持多个提醒时间点
   - 提醒方式选择（小程序通知、微信消息等）

4. **分类与标签**
   - 日历分类选择（工作、个人、家庭等）
   - 标签添加功能

5. **农历参考信息**
   - 显示所选日期的农历信息
   - 显示宜忌信息作为参考
   - 提供更适合的日期建议（可选功能）

#### 3.3.3 交互设计

1. **页面导航**
   - 顶部提供"取消"和"保存"按钮
   - "取消"按钮：放弃当前编辑并返回
   - "保存"按钮：保存日程并返回
   - 编辑已存在日程时底部显示"删除"按钮

2. **表单交互**
   - 点击日期区域：打开日期选择器
   - 点击时间区域：打开时间选择器
   - 开启全天事件开关：自动隐藏时间选择器
   - 点击重复规则：展开重复规则选项列表
   - 点击颜色选择区：弹出颜色选择器

3. **农历信息展示**
   - 随日期选择实时更新农历信息
   - 点击农历信息区域：可切换公历/农历优先的选择模式

#### 3.3.4 API接口需求

1. **创建日程接口**
   ```
   POST /api/events
   请求参数：事件完整信息对象
   响应：创建结果和事件ID
   ```

2. **更新日程接口**
   ```
   PUT /api/events/{id}
   请求参数：事件更新信息对象
   响应：更新结果
   ```

3. **删除日程接口**
   ```
   DELETE /api/events/{id}
   请求参数：事件ID
   响应：删除结果
   ```

4. **日期转换接口**
   ```
   GET /api/calendar/convert
   请求参数：date, type (公历到农历或农历到公历)
   响应：转换结果
   ```

#### 3.3.5 表单校验规则

- **标题**：必填，最多50个字符
- **日期**：必填，有效日期格式
- **时间**：非全天事件必填，有效时间格式
- **重复规则**：可选，但选择自定义时必须指定具体规则
- **提醒设置**：可选，但添加提醒时需完整设置

### 3.4 天气详情页 (weather)

#### 3.4.1 页面描述
提供当前城市及用户关注城市的天气信息，包括实时天气、24小时预报、7天预报、空气质量以及天气预警信息。

#### 3.4.2 功能需求

1. **城市管理**
   - 显示当前选中城市
   - 支持切换城市功能
   - 支持定位到当前位置
   - 城市列表记忆功能

2. **实时天气信息**
   - 当前温度大字号显示
   - 天气状态图标和文字描述
   - 体感温度、湿度、风向风速信息
   - 紫外线指数、降水概率等实用指数

3. **天气预报**
   - 24小时逐小时预报，横向滚动显示
   - 7天天气预报，包含日期、天气图标、温度范围
   - 提供气温变化趋势图表

4. **空气质量**
   - AQI指数及空气质量等级
   - PM2.5、PM10、O3等详细指标数据
   - 空气质量趋势预测

5. **天气预警**
   - 显示当前地区有效的天气预警信息
   - 预警严重程度分级显示
   - 提供详细预警内容和防范建议

#### 3.4.3 交互设计

1. **页面导航**
   - 顶部城市名称区域可点击切换城市
   - 城市名称旁显示定位图标，点击可更新定位
   - 底部导航栏中"天气"选项高亮

2. **内容区交互**
   - 支持下拉刷新更新天气数据
   - 24小时预报区域支持左右滑动
   - 点击天气预警条横幅展开详细信息
   - 点击每日天气行展开/收起详细预报

3. **城市切换**
   - 点击城市名称弹出城市选择器
   - 提供快速切换最近使用城市功能
   - 长按城市可设为默认城市

#### 3.4.4 API接口需求

1. **城市列表接口**
   ```
   GET /api/weather/cities
   请求参数：无
   响应：用户添加的城市列表
   ```

2. **城市搜索接口**
   ```
   GET /api/weather/search
   请求参数：keyword
   响应：匹配的城市列表
   ```

3. **天气数据接口**
   ```
   GET /api/weather/current
   请求参数：city_id, need_hourly, need_daily, need_indices
   响应：指定城市的天气数据
   ```

4. **天气预警接口**
   ```
   GET /api/weather/alerts
   请求参数：city_id
   响应：当前有效的天气预警信息
   ```

#### 3.4.5 页面状态管理

- **数据更新频率**：实时天气每30分钟自动更新一次
- **数据缓存策略**：本地缓存最后获取的天气数据，无网络时显示缓存数据
- **定位状态**：显示定位成功/失败状态，提供手动重试选项
- **极端天气**：遇到预警信息时通过颜色和样式突出显示

### 3.5 城市管理页 (location_select)

#### 3.5.1 页面描述
允许用户搜索、添加、删除和管理天气城市，支持自动定位和手动选择城市，管理城市列表的展示顺序。

#### 3.5.2 功能需求

1. **城市查找功能**
   - 城市名称搜索框
   - 搜索结果列表显示
   - 支持模糊匹配和拼音搜索
   - 支持行政区划层级选择

2. **城市列表管理**
   - 定位城市（优先显示）
   - 热门城市展示
   - 最近访问城市记录
   - 自定义城市列表顺序
   - 删除已添加城市

3. **定位功能**
   - 自动定位当前所在城市
   - 定位开关控制
   - 定位权限获取提示
   - 定位失败后的重试机制

4. **编辑模式**
   - 城市列表编辑模式开关
   - 城市拖动排序功能
   - 城市删除功能
   - 设为默认城市功能

#### 3.5.3 交互设计

1. **页面导航**
   - 顶部提供返回按钮返回天气页
   - 顶部右侧提供添加按钮
   - 底部操作栏提供编辑/完成按钮

2. **搜索交互**
   - 点击搜索框自动聚焦并弹出键盘
   - 输入内容实时显示搜索结果
   - 点击搜索结果项添加到城市列表
   - 搜索历史记录功能

3. **列表交互**
   - 点击城市项直接跳转至对应城市天气页
   - 左滑城市项显示删除按钮
   - 编辑模式下显示删除图标和排序图标
   - 长按城市可拖动调整顺序

4. **底部操作区交互**
   - 点击编辑按钮进入编辑模式
   - 点击完成按钮退出编辑模式并保存变更
   - 点击自动定位按钮触发定位功能

#### 3.5.4 API接口需求

1. **城市搜索接口**
   ```
   GET /api/cities/search
   请求参数：keyword
   响应：匹配的城市列表
   ```

2. **热门城市接口**
   ```
   GET /api/cities/popular
   请求参数：无或region
   响应：热门城市列表
   ```

3. **城市管理接口**
   ```
   POST /api/user/cities
   请求参数：操作类型(add/remove/sort)，城市信息
   响应：操作结果
   ```

4. **地理定位接口**
   ```
   GET /api/location/current
   请求参数：经纬度
   响应：定位城市信息
   ```

#### 3.5.5 页面状态管理

- **权限状态**：首次使用请求定位权限，记住用户选择
- **编辑模式**：进入编辑模式后UI元素变化，显示删除、排序控件
- **搜索状态**：搜索中显示加载状态，结果为空显示空状态提示
- **定位状态**：显示定位中、成功、失败状态，并提供适当操作建议

### 3.6 黄历详情页 (almanac)

#### 3.6.1 页面描述
展示传统黄历信息，包括日期查询、宜忌事项、吉神凶煞、胎神方位等传统黄历内容，是传统文化特色的核心页面。

#### 3.6.2 功能需求

1. **日期选择功能**
   - 顶部日期选择器，公历日期展示
   - 农历日期大字号显示
   - 左右箭头可切换前后日期
   - 点击日期可跳转至日期选择器

2. **宜忌展示**
   - 分类展示"宜"和"忌"事项
   - 每项宜忌可点击查看详细解释
   - 适宜日程建议功能

3. **神位信息**
   - 财神、喜神、福神等方位指示
   - 胎神所在方位提示
   - 吉神凶煞详细列表

4. **时辰查询**
   - 十二时辰吉凶表
   - 每个时辰的宜忌详情
   - 最佳时辰推荐

5. **传统知识推荐**
   - 相关传统节日、习俗介绍
   - 黄历知识科普内容
   - 个性化推荐内容

#### 3.6.3 交互设计

1. **日期操作**
   - 左右滑动切换日期
   - 点击日期文字弹出日期选择器
   - 长按当前日期可快速回到今天

2. **内容区交互**
   - 宜忌列表项点击展开详细解释
   - 吉神凶煞区域可展开/收起
   - 点击"收起更多"/"展开更多"按钮控制内容展示
   - 点击八卦图可旋转查看

3. **推荐内容交互**
   - 推荐内容卡片支持左右滑动
   - 点击推荐卡片查看详细内容
   - 点击"更多"查看全部推荐

#### 3.6.4 API接口需求

1. **黄历数据接口**
   ```
   GET /api/almanac/date
   请求参数：date (YYYY-MM-DD格式)
   响应：指定日期的黄历详细信息
   ```

2. **择日指南接口**
   ```
   GET /api/almanac/guide
   请求参数：activity_type, start_date, end_date
   响应：适宜特定活动的日期推荐
   ```

3. **黄历内容接口**
   ```
   GET /api/almanac/content
   请求参数：type, limit
   响应：黄历知识、传统节日等推荐内容
   ```

#### 3.6.5 页面状态管理

- **日期切换**：切换日期时平滑动画过渡
- **内容加载**：分段加载内容，避免一次性加载过多数据
- **个性化推荐**：基于用户查询历史推荐相关内容
- **分享功能**：支持生成当日黄历图片分享到社交平台

### 3.7 黄历设置页 (almanac_settings)

#### 3.7.1 页面描述
允许用户自定义黄历功能的显示内容、提醒设置和算法版本等偏好设置，提供个性化黄历体验。

#### 3.7.2 功能需求

1. **显示设置**
   - 黄历功能总开关
   - 宜忌提示显示设置
   - 吉神凶煞显示设置
   - 彭祖百忌显示设置
   - 时辰信息显示设置

2. **提醒设置**
   - 节日节气提醒设置
   - 宜忌提醒时间设置
   - 提醒方式选择（小程序通知、微信消息）
   - 特定活动提醒（如结婚、乔迁等）

3. **高级设置**
   - 黄历算法版本选择（传统版、现代调整版）
   - 区域性黄历规则设置（不同地区有不同传统）
   - 个性化推荐内容控制
   - 历史查询记录管理

4. **数据管理**
   - 数据同步选项
   - 清除本地缓存
   - 恢复默认设置
   - 备份与恢复用户设置

#### 3.7.3 交互设计

1. **页面导航**
   - 顶部提供返回按钮返回黄历页
   - 分组展示各类设置项
   - 底部固定导航栏保持一致

2. **设置项交互**
   - 开关类设置直接切换生效
   - 点击带有选择箭头的项目弹出选择器
   - 数据管理操作弹出确认对话框
   - 恢复默认设置需二次确认

3. **信息提示**
   - 关于黄历传统与现代科学关系的说明
   - 算法版本的差异说明
   - 权限获取必要性说明

#### 3.7.4 API接口需求

1. **用户设置获取接口**
   ```
   GET /api/user/settings/almanac
   请求参数：无
   响应：用户当前黄历设置
   ```

2. **用户设置更新接口**
   ```
   PUT /api/user/settings/almanac
   请求参数：设置对象
   响应：更新结果
   ```

3. **设置同步接口**
   ```
   POST /api/user/settings/sync
   请求参数：操作类型(upload/download)
   响应：同步结果
   ```

#### 3.7.5 设置数据结构

- **almanacSettings**：包含所有黄历相关设置的对象
  - **display**：控制显示内容的对象
  - **notification**：控制提醒设置的对象
  - **algorithm**：控制算法设置的对象
  - **region**：区域性规则设置
  - **personalization**：个性化设置

### 3.8 星座运势页 (horoscope)

#### 3.8.1 页面描述
提供十二星座的每日运势信息，包括整体运势、爱情、事业、财富等方面的预测，满足用户对运势的关注需求。

#### 3.8.2 功能需求

1. **星座选择**
   - 十二星座图标网格展示
   - 当前选中星座突出显示
   - 用户星座记忆功能
   - 星座信息快速切换

2. **运势内容**
   - 整体运势总结与星级评分
   - 分类运势详解（爱情、事业、财富、健康）
   - 幸运色、幸运数字、速配星座等信息
   - 运势变化趋势图表

3. **时间范围选择**
   - 今日运势
   - 明日运势
   - 本周运势
   - 本月运势
   - 年度运势

4. **互动功能**
   - 运势收藏功能
   - 运势分享功能
   - 星座内容推荐
   - 星座配对测试

#### 3.8.3 交互设计

1. **星座选择交互**
   - 点击星座图标切换当前显示的星座
   - 左右滑动运势卡片切换星座
   - 顶部星座选择器可下拉展开全部选项

2. **内容区交互**
   - 运势卡片支持上下滑动查看完整内容
   - 分类标签可点击跳转至对应详细内容
   - 点击时间范围标签切换不同周期的运势

3. **功能按钮交互**
   - 收藏按钮可切换收藏状态
   - 分享按钮生成图片分享至社交媒体
   - 长按运势内容可复制文本

#### 3.8.4 API接口需求

1. **星座运势接口**
   ```
   GET /api/horoscope
   请求参数：sign_id, type(today/tomorrow/week/month/year)
   响应：指定星座和时间范围的运势数据
   ```

2. **星座信息接口**
   ```
   GET /api/horoscope/info
   请求参数：sign_id
   响应：星座基本信息、特性、历史等
   ```

3. **星座配对接口**
   ```
   GET /api/horoscope/match
   请求参数：sign_id1, sign_id2
   响应：两个星座的配对信息和评分
   ```

#### 3.8.5 页面状态管理

- **星座切换**：切换星座时平滑动画过渡
- **运势更新**：每日凌晨自动更新运势数据
- **收藏状态**：实时同步本地和云端收藏状态
- **缓存策略**：本地缓存最近查看的星座运势，减少请求频率

### 3.9 搜索页 (search)

#### 3.9.1 页面描述
提供全局搜索功能，支持搜索节气、节日、日期、日程等信息，并展示分类结果，方便用户快速查找所需内容。

#### 3.9.2 功能需求

1. **搜索输入**
   - 搜索框自动聚焦，支持实时输入
   - 支持语音输入功能
   - 清空按钮一键清除搜索内容
   - 搜索历史记录功能

2. **搜索结果过滤**
   - 分类过滤选项（全部、节气、传统节日、现代节日、黄历宜忌等）
   - 结果排序选项（相关度、时间先后）
   - 时间范围筛选（本月、本年、不限）

3. **搜索结果展示**
   - 按类别分组展示搜索结果
   - 结果项显示标题、图标和简要描述
   - 搜索关键词高亮显示
   - 无结果时的相关推荐

4. **特殊搜索功能**
   - 日期转换查询（如"农历二月初二是哪天"）
   - 节气查询（如"今年清明节是几月几号"）
   - 黄历宜忌查询（如"适合结婚的日子"）
   - 日程搜索（如"下周的会议"）

#### 3.9.3 交互设计

1. **搜索页导航**
   - 顶部提供返回按钮返回上一页
   - 搜索框常驻顶部，支持实时输入
   - 底部过滤选项可横向滚动切换

2. **输入交互**
   - 输入时实时显示匹配结果
   - 点击清除按钮清空输入内容
   - 点击语音图标启动语音输入
   - 搜索历史显示最近10条搜索记录

3. **结果交互**
   - 点击搜索结果项跳转至对应详情页
   - 点击分类标签筛选当前类别结果
   - 长按搜索结果可复制信息
   - 下拉刷新更新搜索结果

#### 3.9.4 API接口需求

1. **全局搜索接口**
   ```
   GET /api/search
   请求参数：query, categories, page, page_size
   响应：分类搜索结果，包含各类匹配内容
   ```

2. **搜索建议接口**
   ```
   GET /api/search/suggest
   请求参数：query, limit
   响应：搜索建议列表
   ```

3. **搜索历史接口**
   ```
   GET /api/user/search/history
   请求参数：limit
   响应：用户搜索历史记录
   ```

4. **特殊查询接口**
   ```
   POST /api/search/special
   请求参数：query, type
   响应：日期转换、节气查询等特殊查询结果
   ```

#### 3.9.5 页面状态管理

- **搜索状态**：输入中、搜索中、搜索完成、搜索失败等状态的UI展示
- **空结果处理**：没有匹配结果时显示推荐搜索或热门内容
- **历史记录**：本地存储搜索历史，支持云端同步
- **结果缓存**：缓存最近搜索结果，减少重复请求

### 3.10 个人设置页 (settings)

#### 3.10.1 页面描述
提供应用的全局设置功能，允许用户调整个人信息、通知设置、主题等应用设置，管理用户偏好和账号信息。

#### 3.10.2 功能需求

1. **用户资料管理**
   - 用户头像和昵称展示
   - 微信账号绑定/登录状态
   - 会员等级显示
   - 个人资料修改入口

2. **应用设置**
   - 通知提醒设置
   - 主题颜色设置
   - 字体大小调整
   - 首页默认视图设置
   - 开屏页设置

3. **功能设置**
   - 日历默认视图设置
   - 天气单位设置（摄氏度/华氏度）
   - 黄历显示设置
   - 星座运势设置
   - 离线模式设置

4. **数据管理**
   - 数据同步设置
   - 本地缓存清理
   - 数据备份与恢复
   - 导出日程数据

5. **其他功能**
   - 关于我们
   - 用户反馈
   - 隐私政策
   - 用户协议
   - 版本信息

#### 3.10.3 交互设计

1. **页面导航**
   - 底部导航栏"我的"选项高亮
   - 各设置项分类展示
   - 设置项右侧显示当前值或进入箭头

2. **设置项交互**
   - 点击用户信息卡片进入个人资料详情页
   - 点击各设置项进入对应的二级设置页面
   - 开关类设置直接在当前页面切换
   - 会员信息点击进入会员中心页面

3. **登录状态交互**
   - 未登录状态显示登录按钮
   - 已登录状态显示用户信息
   - 提供退出登录选项

#### 3.10.4 API接口需求

1. **用户信息接口**
   ```
   GET /api/user/profile
   请求参数：无
   响应：用户资料信息
   ```

2. **设置获取接口**
   ```
   GET /api/user/settings
   请求参数：无
   响应：用户所有设置
   ```

3. **设置更新接口**
   ```
   PUT /api/user/settings
   请求参数：设置对象
   响应：更新结果
   ```

4. **缓存清理接口**
   ```
   POST /api/user/cache/clear
   请求参数：cache_type
   响应：清理结果
   ```

#### 3.10.5 设置数据结构

- **userSettings**：包含所有用户设置的对象
  - **notification**：通知相关设置
  - **display**：显示相关设置
  - **calendar**：日历相关设置
  - **weather**：天气相关设置
  - **sync**：同步相关设置
  - **theme**：主题相关设置

## 4. 系统功能与服务

### 4.1 数据同步服务

#### 4.1.1 功能描述
实现用户数据在多设备之间的无缝同步，包括日程、城市列表、设置等个人数据。

#### 4.1.2 具体需求

- **实时同步**：用户修改数据后自动推送到云端
- **本地缓存**：离线状态下操作保存在本地，联网后自动同步
- **冲突解决**：多设备同时编辑时的冲突检测和解决策略
- **选择性同步**：允许用户选择需要同步的数据类型
- **数据版本控制**：支持历史版本查看和恢复

#### 4.1.3 实现策略

- 采用微信云开发数据库存储用户数据
- 使用时间戳和版本号控制数据版本
- 定义明确的冲突解决规则（后者优先或保留两份）
- 实现定期自动同步和手动触发同步机制

### 4.2 通知与提醒服务

#### 4.2.1 功能描述
为用户提供日程提醒、节日提醒、天气预警等推送通知服务，确保用户不会错过重要信息。

#### 4.2.2 具体需求

- **日程提醒**：按用户设置的时间提前发送日程提醒
- **节日提醒**：传统节日、节气和公共假日提醒
- **天气提醒**：天气预警信息和异常天气变化提醒
- **黄历提醒**：每日黄历宜忌信息自动推送
- **定制化提醒**：用户可设置提醒类型、频率和方式

#### 4.2.3 实现策略

- 使用微信小程序订阅消息能力
- 实现本地和服务端双重提醒机制
- 为小程序订阅消息设计模板
- 实现提醒发送队列和失败重试机制

### 4.3 离线功能支持

#### 4.3.1 功能描述
确保用户在无网络环境下仍能使用小程序的基本功能，提高应用可用性。

#### 4.3.2 具体需求

- **核心数据缓存**：公历、农历数据本地存储
- **用户数据本地存储**：日程、设置等本地保存
- **最新天气缓存**：最后获取的天气数据缓存
- **黄历基础数据**：基础黄历信息本地存储
- **页面离线访问**：主要页面支持离线访问

#### 4.3.3 实现策略

- 使用微信小程序本地存储API存储关键数据
- 实现数据过期策略和自动更新机制
- 设计离线友好的UI，清晰指示离线状态
- 优先加载本地数据，提高响应速度

### 4.4 用户账号管理

#### 4.4.1 功能描述
提供用户注册、登录、信息管理功能，实现数据的用户隔离和个性化服务。

#### 4.4.2 具体需求

- **微信授权登录**：一键登录，无需额外注册
- **用户资料管理**：头像、昵称、地区等信息管理
- **账号绑定**：支持手机号绑定功能
- **会员体系**：基础会员和高级会员权益管理
- **数据隐私保护**：用户数据访问控制和隐私保护

#### 4.4.3 实现策略

- 使用微信开放能力获取用户基本信息
- 实现基于角色的权限控制系统
- 设计完整的用户数据模型
- 实现数据加密存储和传输

## 5. 会员功能与增值服务

### 5.1 会员体系设计

#### 5.1.1 会员等级划分

- **免费用户**：基础功能免费使用
- **普通会员**（月费制）：解锁更多功能，无广告
- **年度会员**（年费制）：全功能，优惠价格，专属服务
- **永久会员**（一次性付费）：终身享受会员权益，限时优惠

#### 5.1.2 会员权益

| 功能 | 免费用户 | 普通会员 | 年度会员 | 永久会员 |
|------|---------|---------|---------|---------|
| 基础日历查询 | ✓ | ✓ | ✓ | ✓ |
| 基础黄历查询 | ✓ | ✓ | ✓ | ✓ |
| 天气预报 | 最多3个城市 | 不限城市数 | 不限城市数 | 不限城市数 |
| 日程数量 | 20条 | 不限 | 不限 | 不限 |
| 广告展示 | 有 | 无 | 无 | 无 |
| 黄历详解 | 基础内容 | 全部内容 | 全部内容 | 全部内容 |
| 择日功能 | 基础推荐 | 详细分析 | 详细分析 | 详细分析 |
| 运势详解 | 今日运势 | 月度运势 | 年度运势 | 年度运势 |
| 专属主题 | 无 | 部分 | 全部 | 全部+独享 |
| 数据同步 | 基础同步 | 全量同步 | 全量同步 | 全量同步 |
| 数据导出 | 无 | 基础导出 | 高级导出 | 高级导出 |
| 客服支持 | 普通 | 优先 | 绿色通道 | 专属客服 |

#### 5.1.3 会员价格策略

- **普通会员**：¥6/月
- **年度会员**：¥58/年（相当于¥4.83/月，节省20%）
- **永久会员**：¥168/终身（限时特惠¥118）
- **家庭共享**：年度会员可额外添加2个家庭成员（+¥20/年）

### 5.2 增值服务

#### 5.2.1 个性化择日服务

- **功能描述**：根据用户需求提供个性化择日建议，适用于结婚、乔迁、开业等重要活动
- **服务内容**：详细日期分析、多日期对比、专业文字解释、吉日证书生成
- **收费模式**：单次购买，¥9.9-29.9不等，根据服务复杂度定价

#### 5.2.2 专业运势解读

- **功能描述**：提供专业的个人运势分析和解读，包括事业、感情、财运等方面
- **服务内容**：月度运势、年度运势、重要时期运势、运势改善建议
- **收费模式**：单次购买，¥15.8-68不等，根据服务深度定价

#### 5.2.3 专属节日提醒卡片

- **功能描述**：为重要节日和纪念日提供精美的提醒卡片，支持分享到社交平台
- **服务内容**：多款精美卡片模板、可自定义文字和图片、智能祝福语生成
- **收费模式**：单次购买¥3-6/张，套餐购买更优惠

## 6. 数据安全与隐私保护

### 6.1 数据收集说明

#### 6.1.1 必要收集的数据
- 用户OpenID（用于识别用户）
- 位置信息（仅用于天气功能，可关闭）
- 日程内容（用于日程管理功能）
- 设备信息（用于优化用户体验）

#### 6.1.2 可选收集的数据
- 用户昵称和头像（需用户授权）
- 搜索历史（用于提供搜索建议，可清除）
- 使用行为数据（用于功能优化，可选择不参与）

### 6.2 数据使用原则

- **最小化原则**：仅收集必要的用户数据
- **透明原则**：明确告知用户数据的收集和使用方式
- **安全原则**：采取严格的数据加密和保护措施
- **控制原则**：用户可控制个人数据的授权和删除

### 6.3 数据安全措施

- 敏感数据传输加密（HTTPS）
- 用户数据存储加密
- 定期数据备份和恢复机制
- 访问控制和权限管理
- 数据隔离存储，防止混用
- 定期安全审计和漏洞扫描

## 7. 用户运营与推广计划

### 7.1 用户获取策略

#### 7.1.1 线上渠道
- 微信生态内推广（公众号、小程序广告位）
- 搜索引擎优化（微信搜索、百度小程序）
- 社交媒体营销（微博、抖音、小红书）
- KOL合作推广（传统文化、生活方式领域）
- 线上广告投放（精准定向投放）

#### 7.1.2 线下触点
- 传统节日活动合作（节日期间推广）
- 特色实体店合作（如茶馆、文创店等）
- 二维码场景布置（适合场景下的引导扫码）
- 校园推广活动（传统文化教育活动）

### 7.2 用户留存策略

#### 7.2.1 内容运营
- 每日精选内容推送（黄历解读、节气文化）
- 传统节日特别策划（重要节日前的预热和策划）
- 用户分享鼓励（生成精美图片便于分享）
- 实用工具持续更新（保持功能新鲜感）

#### 7.2.2 用户激励
- 签到奖励机制（连续使用得积分或特权）
- 会员成长体系（使用时长和频次带来的权益）
- 限时会员优惠（节日特惠、首次使用优惠）
- 邀请好友奖励（邀请新用户获得特权）

### 7.3 用户活跃策略

#### 7.3.1 社区互动
- 黄历知识问答（用户参与互动答题）
- 传统节日打卡（节日期间的特别活动）
- 用户经验分享（分享使用心得和小技巧）
- 民俗探讨（围绕传统文化的讨论）

#### 7.3.2 个性化体验
- 智能推荐系统（基于用户行为的内容推荐）
- 个人专属运势解读（让用户持续关注）
- 用户偏好学习（逐步优化推荐准确性）
- 节日专属问候（重要节日的贴心提醒）

## 8. 项目实施路线图

### 8.1 项目阶段划分

#### 8.1.1 第一阶段（1-2个月）：核心功能开发
- 日历基本功能开发
- 黄历基础查询功能实现
- 天气基础功能集成
- 用户系统搭建
- 小程序框架与UI实现

#### 8.1.2 第二阶段（2-3个月）：功能完善与优化
- 日程管理完整功能开发
- 黄历详解与择日功能完善
- 天气预报进阶功能开发
- 星座运势功能实现
- 搜索与个人设置功能开发

#### 8.1.3 第三阶段（1-2个月）：会员体系与增值服务
- 会员系统开发
- 支付功能集成
- 增值服务开发
- 数据同步与备份机制完善
- 性能与体验优化

#### 8.1.4 第四阶段（持续）：运营与迭代
- 内容更新机制建立
- 用户反馈收集与分析
- 新功能规划与开发
- 季节性活动策划与实施
- 数据分析与产品优化

### 8.2 关键里程碑

| 里程碑 | 时间点 | 主要内容 |
|-------|--------|---------|
| 立项与规划 | 第1周 | 完成需求分析和技术方案 |
| 原型设计完成 | 第3周 | 完成所有页面高保真原型 |
| 核心功能上线 | 第6周 | 首个可用版本小程序上线 |
| 功能全部完成 | 第12周 | 所有基础功能完成开发 |
| 会员体系上线 | 第16周 | 会员功能与支付系统上线 |
| 正式推广开始 | 第18周 | 全面启动市场推广计划 |
| 1.0正式版本 | 第20周 | 产品完善，达到正式版要求 |

### 8.3 测试计划

#### 8.3.1 测试阶段
- **内部测试**：开发团队内部功能验证（持续进行）
- **Alpha测试**：邀请少量内部用户测试（每个阶段结束前）
- **Beta测试**：邀请100-500名外部用户参与测试（第二阶段后）
- **灰度发布**：按比例向真实用户开放（正式版前）

#### 8.3.2 测试重点
- 功能完整性与正确性测试
- 用户体验与界面交互测试
- 性能与响应速度测试
- 兼容性测试（不同设备、系统版本）
- 数据安全与隐私保护测试
- 支付流程与会员权限测试

## 9. 风险评估与应对策略

### 9.1 产品风险

| 风险 | 可能性 | 影响 | 应对策略 |
|-----|-------|-----|---------|
| 用户接受度低 | 中 | 高 | 前期充分调研，小范围测试收集反馈 |
| 黄历内容准确性争议 | 高 | 中 | 明确数据来源，加入免责声明，提供算法选择 |
| 同质化竞争激烈 | 高 | 高 | 突出传统文化特色，提供差异化功能 |
| 盈利模式不明确 | 中 | 高 | 合理设计会员权益，开发有价值的增值服务 |

### 9.2 技术风险

| 风险 | 可能性 | 影响 | 应对策略 |
|-----|-------|-----|---------|
| 小程序体积超限 | 中 | 高 | 模块化设计，按需加载，资源优化 |
| 数据同步冲突 | 中 | 中 | 完善冲突解决机制，版本控制策略 |
| API调用频率限制 | 高 | 中 | 实现合理的缓存策略，避免频繁请求 |
| 服务器负载过高 | 低 | 高 | 弹性扩容，负载均衡，性能优化 |

### 9.3 运营风险

| 风险 | 可能性 | 影响 | 应对策略 |
|-----|-------|-----|---------|
| 用户增长停滞 | 中 | 高 | 多渠道推广，提升用户分享意愿 |
| 内容更新频率跟不上 | 高 | 中 | 建立内容生产机制，引入自动化工具 |
| 用户投诉增多 | 中 | 高 | 完善客服体系，及时处理用户反馈 |
| 会员转化率低 | 高 | 高 | 优化会员价值，提供试用期，灵活的促销策略 |

---

本需求文档详细描述了中华万年历小程序的产品需求，涵盖功能设计、页面交互、数据模型、会员体系、安全措施、运营策略和实施计划等多个方面。各开发团队应基于此文档进行详细的技术方案设计和实现工作。文档将根据项目进展和市场反馈进行迭代更新。
